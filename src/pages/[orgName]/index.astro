---
import Layout from "@src/layouts/Layout.astro";
import RepositoryList from "@src/components/RepositoryList";
import Breadcrumbs from "@src/components/Breadcrumbs";
import { octokit } from "@src/utils/octokit";

const { orgName } = Astro.params;
const keyword = Astro.url.searchParams.get('keyword') || ''

let q = `org:${orgName}`
if (keyword) {
  q += ` ${keyword}`
}

const { data: { items: repositories } } = await octokit.request('GET /search/repositories', {
  q,
  per_page: 10,
  headers: {
    'X-GitHub-Api-Version': '2022-11-28'
  }
})
---

<Layout>
  <Breadcrumbs names={[orgName!]} />
  <RepositoryList repositories={repositories} defaultKeyword={keyword} />
</Layout>
